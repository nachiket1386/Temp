{% extends "base.html" %}

{% block title %}Supervisors - LAMS{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('views.dashboard') }}">Dashboard</a></li>
        <li class="breadcrumb-item active">Supervisors</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Supervisor Management</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createSupervisorModal">
            <i class="bi bi-person-badge"></i> Add Supervisor
        </button>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-people"></i> Company Supervisors</h5>
            </div>
            <div class="card-body">
                {% if supervisors %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>EP Number</th>
                                <th>Status</th>
                                <th>Created Date</th>
                                <th>Password Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for supervisor in supervisors %}
                            <tr>
                                <td>
                                    <strong>{{ supervisor.username }}</strong>
                                    {% if supervisor.ep_number %}
                                        <br><small class="text-muted">EP: {{ supervisor.ep_number }}</small>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if supervisor.is_active else 'danger' }}">
                                        {{ 'Active' if supervisor.is_active else 'Inactive' }}
                                    </span>
                                </td>
                                <td>{{ supervisor.created_at.strftime('%Y-%m-%d') }}</td>
                                <td>
                                    {% if supervisor.must_change_password %}
                                        <span class="badge bg-warning">Must Change</span>
                                    {% else %}
                                        <span class="badge bg-success">Changed</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <form method="POST" action="{{ url_for('auth.reset_password', user_id=supervisor.id) }}" style="display: inline;">
                                            <button type="submit" class="btn btn-outline-warning" 
                                                    onclick="return confirm('Reset password for {{ supervisor.username }}? New password will be: {{ supervisor.ep_number or supervisor.username }}')">
                                                <i class="bi bi-key"></i> Reset Password
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-person-badge h1 text-muted"></i>
                    <p class="text-muted">No supervisors created yet.</p>
                    <p class="text-muted small">Supervisors must be existing employees. Create supervisor accounts for employees who will manage attendance records.</p>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createSupervisorModal">
                        <i class="bi bi-person-badge"></i> Add First Supervisor
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Create Supervisor Modal -->
<div class="modal fade" id="createSupervisorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('views.create_supervisor') }}">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-person-badge"></i> Create Supervisor Account
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Note:</strong> Supervisor accounts can only be created for existing employees. 
                        The EP number must already exist in the system.
                    </div>
                    
                    <div class="mb-3">
                        <label for="ep_number" class="form-label">Employee EP Number</label>
                        <input type="text" class="form-control" id="ep_number" name="ep_number" required 
                               placeholder="e.g., EP001">
                        <div class="form-text">
                            Enter the EP number of an existing employee who will become a supervisor. 
                            This will also be their login username.
                        </div>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        <small>
                            <strong>Initial Credentials:</strong> The supervisor's initial password will be set to their EP number. 
                            They will be required to change it on first login.
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-person-badge"></i> Create Supervisor
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
